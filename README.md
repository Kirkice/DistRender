# DistRender - æ¸²æŸ“å¼•æ“

ä¸€ä¸ªæ”¯æŒå¤šå›¾å½¢ API çš„ç°ä»£åŒ–æ¸²æŸ“å¼•æ“ï¼Œç›®å‰æ”¯æŒ Vulkanã€DirectX 12 ä¸ wgpuã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¨ **å¤šåç«¯æ”¯æŒ**ï¼šæ”¯æŒ Vulkanï¼ˆè·¨å¹³å°ï¼‰ã€DirectX 12ï¼ˆWindowsï¼‰ã€Metalï¼ˆmacOSï¼‰ä¸ wgpuï¼ˆè·¨å¹³å°æŠ½è±¡åç«¯ï¼‰
- ğŸ”§ **ç»Ÿä¸€æ¥å£**ï¼šç»Ÿä¸€çš„ `renderer::Renderer` æ¥å£ï¼Œåœ¨è¿è¡Œæ—¶é€‰æ‹©åç«¯
- ğŸ›ï¸ **GUI ç³»ç»Ÿ**ï¼š
  - wgpu åç«¯ï¼šå†…ç½® egui é¢æ¿
  - Vulkan/DX12/Metal åç«¯ï¼šå¤–éƒ¨ GUI è¿›ç¨‹ï¼ˆ`dist_render_gui`ï¼‰+ å…±äº«å†…å­˜åŒæ­¥å‚æ•°
- ğŸ–±ï¸ **è¾“å…¥ç³»ç»Ÿ**ï¼šåŸºäº winit çš„é”®é¼ è¾“å…¥ï¼Œæ”¯æŒ WASD ç§»åŠ¨ä¸å³é”®æ‹–æ‹½è§†è§’
- âš¡ **äº‹ä»¶ç³»ç»Ÿ**ï¼šç±»å‹å®‰å…¨ã€é›¶æˆæœ¬æŠ½è±¡çš„äº‹ä»¶å¤„ç†æ¡†æ¶
- ğŸ› ï¸ **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œä¸»ç¨‹åºï¼ˆé»˜è®¤ï¼‰

ç”±äºå·¥ç¨‹åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶ç¨‹åºï¼ˆä¸»æ¸²æŸ“å™¨ + å¤–éƒ¨ GUIï¼‰ï¼Œå·²åœ¨ `Cargo.toml` é…ç½® `default-run = "dist_render"`ï¼Œå› æ­¤ä»¥ä¸‹å‘½ä»¤ä¼šé»˜è®¤è¿è¡Œä¸»ç¨‹åºï¼š

```bash
cargo run
```

### é€‰æ‹©å›¾å½¢åç«¯

- Vulkanï¼š

```bash
cargo run -- --vulkan
```

- DirectX 12ï¼š

```bash
cargo run -- --dx12
```

- Metalï¼ˆmacOSï¼‰ï¼š

```bash
cargo run -- --metal
```

- wgpuï¼š

```bash
cargo run -- --wgpu
```

### å¤–éƒ¨ GUIï¼ˆä»… Vulkan/DX12/Metal é»˜è®¤å¯ç”¨ï¼‰

å½“ä½¿ç”¨ Vulkan / DX12 / Metal åç«¯æ—¶ï¼Œä¸»ç¨‹åºä¼šè‡ªåŠ¨å¯åŠ¨å¤–éƒ¨ GUI ç¨‹åº `dist_render_gui`ï¼Œå¹¶é€šè¿‡å…±äº«å†…å­˜æŠŠ GUI å‚æ•°åŒæ­¥åˆ°æ¸²æŸ“åç«¯ã€‚

ä½ ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ§åˆ¶ï¼š

- å¼ºåˆ¶å¯ç”¨å¤–éƒ¨ GUIï¼š

```bash
cargo run -- --external-gui
```

- ç¦ç”¨å¤–éƒ¨ GUIï¼š

```bash
cargo run -- --no-external-gui
```

### å•ç‹¬è¿è¡Œå¤–éƒ¨ GUI ç¨‹åº

```bash
cargo run --bin dist_render_gui
```

è¯´æ˜ï¼šä¸»ç¨‹åºå¯åŠ¨å¤–éƒ¨ GUI æ—¶ï¼Œä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ï¼š

- **ä¼˜å…ˆï¼ˆBï¼‰**ï¼šä¸»ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶åŒç›®å½•ä¸‹çš„ `dist_render_gui(.exe)`
- **å…œåº•ï¼ˆAï¼‰**ï¼š`target/debug/dist_render_gui(.exe)`

### Release æ¨¡å¼

```bash
cargo run --release
```

## ğŸ“ é¡¹ç›®ç»“æ„ï¼ˆç®€åŒ–ï¼‰

```
DistRender/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs                  # ä¸»æ¸²æŸ“ç¨‹åºå…¥å£ï¼ˆdist_renderï¼‰
â”‚   â”œâ”€â”€ lib.rs                   # åº“å…¥å£ï¼ˆä¾›å¤šä¸ª bin å¤ç”¨ï¼‰
â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â””â”€â”€ dist_render_gui.rs   # å¤–éƒ¨ GUI ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—ï¼šé…ç½®/æ—¥å¿—/æ•°å­¦/è¾“å…¥/äº‹ä»¶ç­‰
â”‚   â”œâ”€â”€ gfx/                     # åç«¯å®ç°ï¼švulkan / dx12 / wgpu
â”‚   â”œâ”€â”€ renderer/                # ç»Ÿä¸€ Renderer æ¥å£ + é€šç”¨æ¸²æŸ“èµ„æº
â”‚   â””â”€â”€ gui/                     # GUI ç³»ç»Ÿï¼ˆwgpu å†…ç½® + å…±äº«å†…å­˜ IPCï¼‰
â””â”€â”€ Cargo.toml
```

## âš¡ äº‹ä»¶ç³»ç»Ÿ

DistRender æä¾›äº†ä¸€ä¸ªç±»å‹å®‰å…¨ã€é«˜æ€§èƒ½çš„äº‹ä»¶å¤„ç†æ¡†æ¶ï¼Œå‚è€ƒäº† DistEngine (C++) çš„è®¾è®¡ç†å¿µã€‚

### ç‰¹æ€§

- âœ… **ç±»å‹å®‰å…¨** - ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- âœ… **é›¶æˆæœ¬æŠ½è±¡** - æ— è¿è¡Œæ—¶å¼€é”€ï¼Œæ€§èƒ½åª²ç¾æ‰‹å†™ä»£ç 
- âœ… **äº‹ä»¶å¤„ç†é“¾** - æ”¯æŒå¤šä¸ªå¤„ç†å™¨é“¾å¼å¤„ç†åŒä¸€äº‹ä»¶
- âœ… **æ˜“äºæ‰©å±•** - è½»æ¾æ·»åŠ æ–°çš„äº‹ä»¶ç±»å‹

### æ”¯æŒçš„äº‹ä»¶ç±»å‹

| ç±»åˆ« | äº‹ä»¶ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| **çª—å£** | `WindowResizeEvent` | çª—å£å¤§å°è°ƒæ•´ |
| | `WindowCloseEvent` | çª—å£å…³é—­ |
| **é¼ æ ‡** | `MouseButtonEvent` | é¼ æ ‡æŒ‰é’®æŒ‰ä¸‹/é‡Šæ”¾ |
| | `MouseMoveEvent` | é¼ æ ‡ç§»åŠ¨ |
| | `MouseScrollEvent` | é¼ æ ‡æ»šè½® |
| **é”®ç›˜** | `KeyboardEvent` | é”®ç›˜æŒ‰é”®æŒ‰ä¸‹/é‡Šæ”¾ |
| **ç³»ç»Ÿ** | `TickEvent` | æ¯å¸§æ—¶é’Ÿäº‹ä»¶ |
| | `DrawEvent` | ç»˜åˆ¶äº‹ä»¶ |

### è¿è¡Œæ¼”ç¤º

```bash
cargo run --example event_system_demo
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„ï¼ˆæ¦‚å¿µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application                       â”‚  åº”ç”¨å±‚ï¼ˆmain.rsï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Rendererï¼ˆç»Ÿä¸€æ¥å£ï¼‰                   â”‚  æ¸²æŸ“å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vulkan  â”‚   DX12   â”‚  Metal   â”‚     wgpu      â”‚  åç«¯å±‚
â”‚ Renderer â”‚ Renderer â”‚ Renderer â”‚   Renderer    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ï¿½ ä¾èµ–è¦æ±‚

### é€šç”¨ä¾èµ–

- **Rust**ï¼šæ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆï¼ˆ1.70+ï¼‰
- **CMake**ï¼šç”¨äºç¼–è¯‘ shadercï¼ˆShader ç¼–è¯‘åº“ï¼‰

### macOS - Metal åç«¯

Metal åç«¯æ˜¯ macOS åŸç”Ÿå›¾å½¢ APIï¼Œéœ€è¦ä»¥ä¸‹ç¯å¢ƒï¼š

- **macOS 10.13+**ï¼ˆHigh Sierra æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- **Xcode Command Line Tools**ï¼š
  ```bash
  xcode-select --install
  ```

- **ä¾èµ– crate**ï¼š
  - `metal = "0.27.0"` - Metal API ç»‘å®š
  - `objc = "0.2.7"` - Objective-C è¿è¡Œæ—¶
  - `cocoa = "0.25.0"` - macOS AppKit é›†æˆ

### å…¶ä»–å¹³å°

- **Windows**ï¼šDirectX 12 éœ€è¦ Windows 10+
- **Linux**ï¼šVulkan éœ€è¦å®‰è£…å¯¹åº”é©±åŠ¨

### Shader ç¼–è¯‘

æ‰€æœ‰åç«¯éƒ½éœ€è¦ **shaderc** ç”¨äºåœ¨æ„å»ºæ—¶ç¼–è¯‘ Shaderï¼š

```bash
# macOS
brew install cmake

# Ubuntu/Debian
sudo apt-get install cmake

# Windows
# é€šè¿‡ Visual Studio Installer å®‰è£… CMake
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### Metal åç«¯ï¼ˆmacOSï¼‰

1. **åæ ‡ç³»ç»Ÿ**ï¼šMetal ä½¿ç”¨ Y-up åæ ‡ç³»ï¼ˆä¸ OpenGL ä¸€è‡´ï¼‰ï¼Œæ·±åº¦èŒƒå›´ [0, 1]
2. **Shader è¯­è¨€**ï¼šä½¿ç”¨ Metal Shading Language (MSL)ï¼ŒShader æ–‡ä»¶ä½äº `src/gfx/metal/shaders/shader.metal`
3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å·²å¯ç”¨ä¸‰é‡ç¼“å†²ï¼ˆ`maximum_drawable_count = 3`ï¼‰ä»¥å‡å°‘å¸§å»¶è¿Ÿ
   - Depth correction çŸ©é˜µå·²é¢„è®¡ç®—å¹¶ç¼“å­˜
4. **GUI æ”¯æŒ**ï¼šMetal åç«¯é»˜è®¤å¯ç”¨å¤–éƒ¨ GUIï¼Œå¯é€šè¿‡ `--no-external-gui` ç¦ç”¨

### è·¨åç«¯å¼€å‘

ç”±äºä¸åŒå›¾å½¢ API çš„åæ ‡ç³»ç»Ÿå·®å¼‚ï¼Œåœ¨å®ç°æ–°åŠŸèƒ½æ—¶éœ€æ³¨æ„ï¼š

| åç«¯ | NDC Y è½´ | æ·±åº¦èŒƒå›´ | å¤‡æ³¨ |
|------|---------|---------|------|
| OpenGL/Metal | Y-up | [0, 1] (Metal) / [-1, 1] (GL) | Metal éœ€æ·±åº¦æ ¡æ­£ |
| Vulkan | Y-down | [0, 1] | éœ€ Y è½´ç¿»è½¬ |
| DirectX 12 | Y-up | [0, 1] | ä¸ Metal ç±»ä¼¼ |
| wgpu | åç«¯ä¾èµ– | åç«¯ä¾èµ– | è‡ªåŠ¨å¤„ç†å·®å¼‚ |

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Rust**ï¼šç³»ç»Ÿç¼–ç¨‹è¯­è¨€
- **Winit**ï¼šè·¨å¹³å°çª—å£ç®¡ç†
- **Vulkan**ï¼šé€šè¿‡ `vulkano`/`ash`
- **DirectX 12**ï¼šé€šè¿‡ `windows-rs`
- **Metal**ï¼šé€šè¿‡ `metal-rs` (macOS åŸç”Ÿ)
- **wgpu**ï¼šè·¨å¹³å°å›¾å½¢æŠ½è±¡
- **egui**ï¼šGUI æ¡†æ¶ï¼ˆwgpu å†…ç½®æ¸²æŸ“ï¼›Vulkan/DX12/Metal é€šè¿‡å¤–éƒ¨ GUI + IPC åŒæ­¥ï¼‰

## ğŸ“„ è®¸å¯è¯

MIT License
